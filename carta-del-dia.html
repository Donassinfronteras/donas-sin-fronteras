<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>OrÃ¡culo Prisma - Carta del DÃ­a</title>
  <link rel="stylesheet" href="css/carta-del-dia.css">
</head>
<body>
  <div class="intention-form">
    <input type="text" id="intencion" placeholder="Escribe tu intenciÃ³n">
    <button id="sacar-carta">Sacar Carta</button>
  </div>
  <div class="card-container">
    <div class="watermark">Donas Sin Fronteras â€“ OrÃ¡culo Prisma</div>
    <img id="card-img" class="card-image" src="" alt="Carta del DÃ­a">
    <div class="title" id="card-title">...</div>
    <div class="text-reveal" id="card-message">...</div>
    <div class="footer">OrÃ¡culo Prisma âœ¨</div>
  </div>
  <div id="lectura-ia"></div>

  <!-- BotÃ³n de regreso -->
  <div class="return-btn">
    <a href="oraculo-prisma.html">ðŸ”® Volver al OrÃ¡culo</a>
  </div>

  <script>
    document.getElementById("sacar-carta").addEventListener("click", sacarCarta);

    function sacarCarta() {
      const intencion = document.getElementById("intencion").value || "";

      const lecturaDiv = document.getElementById("lectura-ia");
      lecturaDiv.textContent = 'Cargando...';

      fetch('https://donas-sin-fronteras.onrender.com/api/carta-del-dia')
        .then(res => res.json())
        .then(carta => {
          const esReversa = Math.random() < 0.5;

          document.getElementById("card-img").src = carta["Imagen URL"];
          document.getElementById("card-title").textContent = carta["Nombre de la Carta"];

          if (esReversa) {
            document.getElementById("card-img").style.transform = "rotate(180deg)";
          } else {
            document.getElementById("card-img").style.transform = "rotate(0deg)";
          }

          document.getElementById("card-message").textContent = '';
          document.getElementById("card-message").classList.remove("visible");

          return fetch('https://donas-sin-fronteras.onrender.com/api/lectura', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
              nombreCarta: carta["Nombre de la Carta"],
              significado: carta["Mensaje (Luz)"],
              categoria: carta["CategorÃ­a"],
              intencion,
              esReversa
            })
          });
        })
        .then(res => res.json())
        .then(data => {
          lecturaDiv.textContent = data.lectura;
        })
        .catch(err => {
          lecturaDiv.textContent = 'No se pudo canalizar la carta, intenta de nuevo.';
          console.error(err);
        });
    }
  </script>

  <!-- ðŸ”® Script de seguimiento Metricool -->
  <script>
    (function () {
      var script = document.createElement("script");
      script.type = "text/javascript";
      script.src = "https://tracker.metricool.com/resources/be.js";
      script.onload = function () {
        beTracker.t({ hash: "99f2f6631f8d7b7b2f039fbaf9e1b94c" });
      };
      document.head.appendChild(script);
    })();
  </script>
</body>
</html>
